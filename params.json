{"name":"Estrela","tagline":"Lua web framework for nginx","body":"estrela\r\n=======\r\n\r\nLua framework for nginx or cli (in early stage of development)\r\n\r\n### In a nutshell\r\n\r\n**bootstrap.lua**\r\n```lua\r\nlocal PP = require('estrela.io.pprint').print\r\n\r\nreturn require('estrela.web').App {\r\n    ['$'] = function(app, req, resp)\r\n        app:defer(function()\r\n            print 'Hello from defer!'\r\n        end)\r\n\r\n        local cnt = tonumber(app.SESSION.data.cnt) or 0\r\n        cnt = cnt + 1\r\n        app.SESSION.data.cnt = cnt\r\n\r\n        print cnt\r\n    end,\r\n\r\n    ['/admin/:action/do$'] = function(app)\r\n        print('admin do ', app.route.params.action, '<br/>')\r\n    end,\r\n\r\n    [{account = '/:name$', profile = '/profile/:name$'}] = function(app)\r\n        local url = app.router:urlFor(app.route.name, app.route.params)\r\n        print('Hello from ', app.req.method, ' ', url)\r\n    end,\r\n\r\n    ['/boo'] = {\r\n        GET = function(app, req)\r\n            print 'def GET'\r\n            PP(req.GET)\r\n            PP(req.COOKIE)\r\n        end,\r\n\r\n        POST = function(app, req)\r\n            print 'def POST'\r\n            PP(req.POST)\r\n            PP(req.FILES)\r\n        end,\r\n\r\n        [{'HEAD', 'OPTIONS'}] = function()\r\n            ngx.status = 403\r\n            print 'Go home!'\r\n            return ngx.exit(0)\r\n        end,\r\n    },\r\n\r\n    ['/fail$'] = function()\r\n        -- this function is not defined => throw a HTTP error #500\r\n        -- error will be handled in route 500 below\r\n        fooBar()\r\n    end,\r\n\r\n    [404] = function(app)\r\n        print 'Route is not found'\r\n        --app:sendInternalErrorPage(404, true)\r\n    end,\r\n\r\n    [500] = function(app, req)\r\n        print('Ooops in ', req.url, '\\n', SP(app.error))\r\n    end,\r\n}\r\n\r\napp.filter.before_req:add(function(app)\r\n    app.resp.headers.content_type = 'text/plain'\r\nend)\r\n\r\napp.filter.after_req:add(function()\r\n    print 'Goodbye!'\r\nend)\r\n```\r\n\r\n**nginx.conf**\r\n```nginx\r\nhttp {\r\n    lua_package_path '/path/to/lua/?.lua;/path/to/lua/lib/?.lua;;';\r\n\r\n    server {\r\n        location / {\r\n            content_by_lua_file /path/to/lua/index.lua;\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n**index.lua**\r\n```lua\r\nJSON = require 'cjson' -- lua-cjson is required\r\nJSON.encode_sparse_array(true)\r\n\r\nxpcall(\r\n    function()\r\n        local app = require('bootstrap')\r\n        app.config:load(require('config'))\r\n        app:serve()\r\n    end,\r\n    function(err)\r\n        ngx.log(ngx.ERR, err)\r\n        ngx.status = 500\r\n        ngx.print 'Ooops! Something went wrong'\r\n        ngx.exit(0)\r\n    end\r\n)\r\n```\r\n\r\n**config.lua**\r\n```lua\r\nlocal dev = true\r\n\r\nreturn {\r\n    -- true for verbose error pages\r\n    debug = dev,\r\n\r\n    session = {\r\n        storage = {\r\n            handler = 'estrela.cache.engine.shmem',\r\n            shmem = {\r\n                key = 'session_cache',\r\n            },\r\n        },\r\n        handler = {\r\n            handler = 'estrela.ngx.session.engine.common',\r\n            key_name = 'estrela_sid',\r\n            common = {\r\n            },\r\n            cookie = {\r\n                params = { -- see app.response.COOKIE.empty\r\n                    --ttl = 86400,\r\n                    httponly = true,\r\n                },\r\n            },\r\n        },\r\n    },\r\n\r\n    router = {\r\n        -- nginx.conf \"location /estrela {\"\r\n        pathPrefix = '/estrela',\r\n    },\r\n}\r\n```\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}